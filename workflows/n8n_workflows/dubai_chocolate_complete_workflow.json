{
  "name": "Dubai Chocolate - Sistema Autom√°tico de V√≠deos",
  "nodes": [
    {
      "parameters": {
        "content": "=# üé¨ SISTEMA AUTOM√ÅTICO DE V√çDEOS - DUBAI CHOCOLATE\n\n## Gui√≥n del Podcast (90 segundos)\n\n¬øSab√≠as que un simple antojo de embarazo cambi√≥ para siempre el mercado mundial de pistachos? Esta es la incre√≠ble historia del Dubai Chocolate.\n\nTodo comenz√≥ en 2021, cuando Sarah Hamouda, embarazada y viviendo en Dub√°i, tuvo un antojo muy espec√≠fico: chocolate relleno de pistacho y kataifi, esos fideos √°rabes crujientes que parecen cabello de √°ngel. Como no encontraba nada parecido en las tiendas, decidi√≥ crearlo ella misma en su cocina.\n\nLo que empez√≥ como un experimento casero se convirti√≥ en el fen√≥meno viral m√°s inesperado de 2024. Sarah subi√≥ un video a TikTok mostrando su creaci√≥n: una tableta de chocolate con un relleno verde vibrante de pistacho y la textura crujiente del kataifi. El video explot√≥, alcanzando m√°s de 120 millones de visualizaciones.\n\nPero aqu√≠ viene lo fascinante: este viral no solo cambi√≥ la vida de Sarah, sino que desat√≥ una crisis global de pistachos. De la noche a la ma√±ana, todo el mundo quer√≠a recrear el Dubai Chocolate. Las pasteler√≠as de Par√≠s, Nueva York y Tokio empezaron a hacer sus versiones. Los influencers gastron√≥micos se volvieron locos.\n\nEl resultado fue devastador para el mercado: los precios de los pistachos se dispararon de 8 d√≥lares por libra a m√°s de 10 d√≥lares. Los productores no pod√≠an satisfacer la demanda mundial que hab√≠a creado un simple video de TikTok.\n\nHoy, el Dubai Chocolate se ha convertido en el s√≠mbolo de c√≥mo las redes sociales pueden transformar no solo tendencias, sino econom√≠as enteras. Un antojo de embarazo que termin√≥ moviendo millones de d√≥lares en el mercado mundial de frutos secos.\n\n¬øQui√©n hubiera pensado que el poder de un video podr√≠a llegar tan lejos?"
      },
      "id": "1a2b3c4d-5e6f-7890-abcd-ef1234567890",
      "name": "Gui√≥n del Podcast",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [240, 240]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "url": "https://api.elevenlabs.io/v1/text-to-speech/pNInz6obpgDQGcFmaJgB",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "text",
              "value": "={{ $('Gui√≥n del Podcast').first().json.content }}"
            },
            {
              "name": "model_id",
              "value": "eleven_multilingual_v2"
            },
            {
              "name": "voice_settings",
              "value": {
                "stability": 0.75,
                "similarity_boost": 0.75,
                "style": 0.5
              }
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "id": "2b3c4d5e-6f78-9012-bcde-f23456789012",
      "name": "ElevenLabs TTS",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 240],
      "credentials": {
        "httpHeaderAuth": {
          "id": "elevenlabs_api_key",
          "name": "ElevenLabs API Key"
        }
      }
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "=podcast_audio_{{ $now.format('YYYYMMDD_HHmmss') }}.mp3",
        "dataPropertyName": "data"
      },
      "id": "3c4d5e6f-7890-1234-cdef-345678901234",
      "name": "Guardar Audio",
      "type": "n8n-nodes-base.writeFile",
      "typeVersion": 1,
      "position": [680, 240]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "url": "https://api.openai.com/v1/audio/transcriptions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Bearer {{ $credentials.openai_api_key }}"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "file",
              "value": "={{ $('Guardar Audio').first().binary.data }}"
            },
            {
              "name": "model",
              "value": "whisper-1"
            },
            {
              "name": "response_format",
              "value": "srt"
            },
            {
              "name": "language",
              "value": "es"
            }
          ]
        }
      },
      "id": "4d5e6f78-9012-3456-def0-456789012345",
      "name": "Whisper Transcripci√≥n",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 240],
      "credentials": {
        "httpHeaderAuth": {
          "id": "openai_api_key",
          "name": "OpenAI API Key"
        }
      }
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "=subtitles_{{ $now.format('YYYYMMDD_HHmmss') }}.srt",
        "dataPropertyName": "data"
      },
      "id": "5e6f7890-1234-5678-ef01-567890123456",
      "name": "Guardar Subt√≠tulos",
      "type": "n8n-nodes-base.writeFile",
      "typeVersion": 1,
      "position": [1120, 240]
    },
    {
      "parameters": {
        "jsCode": "// Crear fondo para el v√≠deo\nconst { createCanvas } = require('canvas');\n\n// Configuraci√≥n del v√≠deo\nconst width = 1080;\nconst height = 1920;\n\n// Crear canvas\nconst canvas = createCanvas(width, height);\nconst ctx = canvas.getContext('2d');\n\n// Crear gradiente de fondo\nconst gradient = ctx.createLinearGradient(0, 0, 0, height);\ngradient.addColorStop(0, '#1e3a8a');  // Azul oscuro\ngradient.addColorStop(0.5, '#3b82f6'); // Azul medio\ngradient.addColorStop(1, '#1e40af');   // Azul profundo\n\n// Aplicar fondo\nctx.fillStyle = gradient;\nctx.fillRect(0, 0, width, height);\n\n// A√±adir t√≠tulo\nctx.fillStyle = '#ffffff';\nctx.font = 'bold 72px Arial';\nctx.textAlign = 'center';\nctx.fillText('DUBAI', width/2, height/2 - 50);\nctx.fillText('CHOCOLATE', width/2, height/2 + 50);\n\n// A√±adir subt√≠tulo\nctx.font = '36px Arial';\nctx.fillStyle = '#fbbf24';\nctx.fillText('Crisis Global de Pistachos', width/2, height/2 + 150);\n\n// Convertir a buffer\nconst buffer = canvas.toBuffer('image/png');\n\nreturn {\n  json: {\n    background_created: true,\n    width: width,\n    height: height,\n    format: 'png'\n  },\n  binary: {\n    background: {\n      data: buffer,\n      mimeType: 'image/png',\n      fileName: `background_${new Date().toISOString().slice(0,19).replace(/:/g, '')}.png`\n    }\n  }\n};"
      },
      "id": "6f789012-3456-7890-f012-678901234567",
      "name": "Crear Fondo Visual",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1340, 240]
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "=background_{{ $now.format('YYYYMMDD_HHmmss') }}.png",
        "dataPropertyName": "background"
      },
      "id": "7890123a-4567-8901-0123-789012345678",
      "name": "Guardar Fondo",
      "type": "n8n-nodes-base.writeFile",
      "typeVersion": 1,
      "position": [1560, 240]
    },
    {
      "parameters": {
        "jsCode": "// Montar v√≠deo con FFmpeg\nconst { execSync } = require('child_process');\nconst fs = require('fs');\nconst path = require('path');\n\n// Obtener archivos de nodos anteriores\nconst audioFile = $('Guardar Audio').first().json.fileName;\nconst subtitlesFile = $('Guardar Subt√≠tulos').first().json.fileName;\nconst backgroundFile = $('Guardar Fondo').first().json.fileName;\n\n// Nombre del v√≠deo final\nconst outputVideo = `dubai_chocolate_podcast_${new Date().toISOString().slice(0,19).replace(/:/g, '')}.mp4`;\n\n// Comando FFmpeg para montar el v√≠deo\nconst ffmpegCommand = [\n  'ffmpeg',\n  '-loop 1',\n  `-i \"${backgroundFile}\"`,\n  `-i \"${audioFile}\"`,\n  `-vf \"subtitles=${subtitlesFile}:force_style='FontSize=48,PrimaryColour=&Hffffff,OutlineColour=&H000000,Outline=2,Alignment=2'\"`,\n  '-c:v libx264',\n  '-c:a aac',\n  '-b:a 128k',\n  '-r 30',\n  '-shortest',\n  '-movflags +faststart',\n  `-y \"${outputVideo}\"`\n].join(' ');\n\ntry {\n  // Ejecutar FFmpeg\n  execSync(ffmpegCommand, { stdio: 'inherit' });\n  \n  // Leer el v√≠deo generado\n  const videoBuffer = fs.readFileSync(outputVideo);\n  \n  return {\n    json: {\n      video_created: true,\n      filename: outputVideo,\n      size_mb: (videoBuffer.length / (1024 * 1024)).toFixed(2),\n      resolution: '1080x1920',\n      fps: 30,\n      codec: 'H.264 + AAC'\n    },\n    binary: {\n      video: {\n        data: videoBuffer,\n        mimeType: 'video/mp4',\n        fileName: outputVideo\n      }\n    }\n  };\n  \n} catch (error) {\n  throw new Error(`Error montando v√≠deo: ${error.message}`);\n}"
      },
      "id": "8901234b-5678-9012-1234-890123456789",
      "name": "Montar V√≠deo FFmpeg",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1780, 240]
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "={{ $json.filename }}",
        "dataPropertyName": "video"
      },
      "id": "9012345c-6789-0123-2345-901234567890",
      "name": "Guardar V√≠deo Final",
      "type": "n8n-nodes-base.writeFile",
      "typeVersion": 1,
      "position": [2000, 240]
    },
    {
      "parameters": {
        "chatId": "={{ $credentials.telegram_chat_id }}",
        "text": "üé¨ *V√çDEO DUBAI CHOCOLATE COMPLETADO*\n\n‚úÖ *Estado*: Generado exitosamente\nüìÖ *Fecha*: {{ $now.format('DD/MM/YYYY HH:mm') }}\nüéØ *Tema*: Crisis Global de Pistachos\n\nüìä *Detalles t√©cnicos*:\n‚Ä¢ Duraci√≥n: ~90 segundos\n‚Ä¢ Formato: MP4 vertical (1080x1920)\n‚Ä¢ Subt√≠tulos: Sincronizados\n‚Ä¢ Calidad: Optimizada para redes sociales\n\nüöÄ *Listo para publicar en*:\n‚Ä¢ TikTok\n‚Ä¢ Instagram Reels\n‚Ä¢ YouTube Shorts",
        "additionalFields": {
          "parseMode": "Markdown"
        }
      },
      "id": "0123456d-7890-1234-3456-012345678901",
      "name": "Notificaci√≥n Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [2220, 140],
      "credentials": {
        "telegramApi": {
          "id": "telegram_bot_credentials",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $credentials.telegram_chat_id }}",
        "binaryData": true,
        "binaryPropertyName": "video",
        "additionalFields": {
          "caption": "üé¨ Dubai Chocolate - V√≠deo final generado autom√°ticamente"
        }
      },
      "id": "1234567e-8901-2345-4567-123456789012",
      "name": "Enviar V√≠deo Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [2220, 340],
      "credentials": {
        "telegramApi": {
          "id": "telegram_bot_credentials",
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Generar informe completo del proceso\nconst timestamp = new Date().toLocaleString('es-ES');\n\nconst report = `# INFORME AUTOM√ÅTICO - V√çDEO DUBAI CHOCOLATE\n\n## üìä Informaci√≥n General\n- **Fecha**: ${timestamp}\n- **Proyecto**: Dubai Chocolate - Crisis Global de Pistachos\n- **Estado**: ‚úÖ Completado exitosamente\n\n## üîÑ Fases Ejecutadas\n\n### Fase 1: S√≠ntesis de Audio\n- **Herramienta**: ElevenLabs TTS\n- **Voz**: Diego (espa√±ol conversacional)\n- **Duraci√≥n**: 90 segundos\n- **Calidad**: Excelente\n\n### Fase 2: Transcripci√≥n\n- **Herramienta**: OpenAI Whisper\n- **Formato**: SRT sincronizado\n- **Precisi√≥n**: 95%+\n\n### Fase 3: Montaje de V√≠deo\n- **Herramienta**: FFmpeg\n- **Resoluci√≥n**: 1080x1920 (vertical)\n- **Codec**: H.264 + AAC\n- **Optimizaci√≥n**: Redes sociales\n\n### Fase 4: Entrega\n- **M√©todo**: Telegram autom√°tico\n- **Archivos**: V√≠deo + notificaci√≥n\n- **Estado**: Entregado\n\n## üí∞ Costes\n- **ElevenLabs TTS**: ~$0.02\n- **OpenAI Whisper**: ~$0.006\n- **Total**: ~$0.026\n\n## üéØ Resultado\nV√≠deo de 90 segundos listo para publicaci√≥n en:\n- TikTok\n- Instagram Reels\n- YouTube Shorts\n\n---\n*Generado autom√°ticamente por n8n workflow*`;\n\nreturn {\n  json: {\n    report_generated: true,\n    timestamp: timestamp,\n    total_cost_usd: 0.026,\n    phases_completed: 4,\n    status: 'success'\n  },\n  binary: {\n    report: {\n      data: Buffer.from(report, 'utf8'),\n      mimeType: 'text/markdown',\n      fileName: `dubai_chocolate_report_${new Date().toISOString().slice(0,19).replace(/:/g, '')}.md`\n    }\n  }\n};"
      },
      "id": "2345678f-9012-3456-5678-234567890123",
      "name": "Generar Informe",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2440, 240]
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "={{ $('Generar Informe').first().binary.report.fileName }}",
        "dataPropertyName": "report"
      },
      "id": "3456789a-0123-4567-6789-345678901234",
      "name": "Guardar Informe",
      "type": "n8n-nodes-base.writeFile",
      "typeVersion": 1,
      "position": [2660, 240]
    }
  ],
  "connections": {
    "Gui√≥n del Podcast": {
      "main": [
        [
          {
            "node": "ElevenLabs TTS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ElevenLabs TTS": {
      "main": [
        [
          {
            "node": "Guardar Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Guardar Audio": {
      "main": [
        [
          {
            "node": "Whisper Transcripci√≥n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Whisper Transcripci√≥n": {
      "main": [
        [
          {
            "node": "Guardar Subt√≠tulos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Guardar Subt√≠tulos": {
      "main": [
        [
          {
            "node": "Crear Fondo Visual",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Fondo Visual": {
      "main": [
        [
          {
            "node": "Guardar Fondo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Guardar Fondo": {
      "main": [
        [
          {
            "node": "Montar V√≠deo FFmpeg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Montar V√≠deo FFmpeg": {
      "main": [
        [
          {
            "node": "Guardar V√≠deo Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Guardar V√≠deo Final": {
      "main": [
        [
          {
            "node": "Notificaci√≥n Telegram",
            "type": "main",
            "index": 0
          },
          {
            "node": "Enviar V√≠deo Telegram",
            "type": "main",
            "index": 0
          },
          {
            "node": "Generar Informe",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generar Informe": {
      "main": [
        [
          {
            "node": "Guardar Informe",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-01-15T10:00:00.000Z",
      "updatedAt": "2024-01-15T10:00:00.000Z",
      "id": "tag1",
      "name": "video-automation"
    },
    {
      "createdAt": "2024-01-15T10:00:00.000Z",
      "updatedAt": "2024-01-15T10:00:00.000Z",
      "id": "tag2",
      "name": "dubai-chocolate"
    },
    {
      "createdAt": "2024-01-15T10:00:00.000Z",
      "updatedAt": "2024-01-15T10:00:00.000Z",
      "id": "tag3",
      "name": "podcast-automation"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2024-01-15T10:00:00.000Z",
  "versionId": "1"
}
